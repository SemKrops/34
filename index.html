<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>34 Puzzle</title>

<style>
body{
    margin:0;
    background:#0e111a;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial, sans-serif;
    overflow:hidden;
    color:white;
}

.wrapper{
    width:min(95vw,520px);
}

.topbar{
    text-align:center;
    margin-bottom:10px;
    font-weight:bold;
    font-size:18px;
}

#game{
    position:relative;
    width:100%;
    aspect-ratio:1/1;
    background:#141a28;
    border-radius:20px;
    overflow:hidden;
}

.piece{
    position:absolute;
    width:50%;
    height:50%;
    cursor:grab;
    touch-action:none;
}

.piece:active{
    cursor:grabbing;
}

.locked{
    cursor:default;
}

#confetti{
    position:fixed;
    inset:0;
    pointer-events:none;
}
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="wrapper">
<div class="topbar">
Tijd: <span id="time">00:00</span>
</div>

<div id="game"></div>
</div>

<script>
const RED="#B0002A";
const TAB=30;
const SIZE=200;
const R=18;

let placed=0;
let startTime=null;
let timerInterval=null;

function buildPath(top,right,bottom,left){
const mid=SIZE/2;

function tab(out){
const t=out?TAB:-TAB;
return `c0 -20 ${t} -20 ${t} 0 c0 20 ${-t} 20 ${-t} 0`;
}

let d=`M${R} 0 H${SIZE-R} Q${SIZE} 0 ${SIZE} ${R}`;

if(right)d+=tab(right>0);
d+=`V${SIZE-R} Q${SIZE} ${SIZE} ${SIZE-R} ${SIZE}`;

if(bottom)d+=tab(bottom>0);
d+=`H${R} Q0 ${SIZE} 0 ${SIZE-R}`;

if(left)d+=tab(left>0);
d+=`V${R} Q0 0 ${R} 0 Z`;

return d;
}

const defs=[
{ id:0,x:0,y:0,edges:[0,1,-1,0] },
{ id:1,x:200,y:0,edges:[0,0,1,-1] },
{ id:2,x:0,y:200,edges:[1,-1,0,0] },
{ id:3,x:200,y:200,edges:[-1,0,0,1] }
];

const game=document.getElementById("game");

function createPiece(def){
const div=document.createElement("div");
div.className="piece";
div.dataset.locked="0";

const path=buildPath(...def.edges);

div.innerHTML=`
<svg viewBox="0 0 200 200">
<defs>
<clipPath id="clip${def.id}">
<path d="${path}"/>
</clipPath>
</defs>

<g clip-path="url(#clip${def.id})">
<text x="${200-def.x}" y="${260-def.y}"
font-size="260"
font-weight="900"
fill="${RED}"
text-anchor="middle"
dominant-baseline="middle">34</text>
</g>

<path d="${path}" fill="none" stroke="white" stroke-width="3"/>
</svg>`;

div.style.left=Math.random()*200+"px";
div.style.top=Math.random()*200+"px";

enableDrag(div,def);
game.appendChild(div);
}

function enableDrag(el,def){
let offsetX,offsetY;
let dragging=false;

el.addEventListener("pointerdown",e=>{
if(el.dataset.locked==="1")return;
dragging=true;
el.setPointerCapture(e.pointerId);
offsetX=e.clientX-el.offsetLeft;
offsetY=e.clientY-el.offsetTop;
startTimer();
});

el.addEventListener("pointermove",e=>{
if(!dragging)return;
el.style.left=(e.clientX-offsetX)+"px";
el.style.top=(e.clientY-offsetY)+"px";
});

el.addEventListener("pointerup",()=>{
if(!dragging)return;
dragging=false;

const correctX=(def.x/400)*game.clientWidth;
const correctY=(def.y/400)*game.clientHeight;

if(Math.abs(el.offsetLeft-correctX)<30 &&
   Math.abs(el.offsetTop-correctY)<30){
el.style.left=correctX+"px";
el.style.top=correctY+"px";
el.dataset.locked="1";
placed++;
if(placed===4) win();
}
});
}

function startTimer(){
if(startTime)return;
startTime=Date.now();
timerInterval=setInterval(()=>{
const t=Date.now()-startTime;
document.getElementById("time").innerText=
new Date(t).toISOString().substr(14,5);
},100);
}

function win(){
clearInterval(timerInterval);
launchConfetti();
}

function init(){
defs.forEach(createPiece);
}

init();

/* CONFETTI */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let confetti=[];

function launchConfetti(){
for(let i=0;i<200;i++){
confetti.push({
x:Math.random()*canvas.width,
y:-10,
vy:Math.random()*4+2,
size:Math.random()*6+4
});
}
animate();
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
confetti.forEach(p=>{
p.y+=p.vy;
ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;
ctx.fillRect(p.x,p.y,p.size,p.size);
});
requestAnimationFrame(animate);
}
</script>
</body>
</html>

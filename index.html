<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>34 Puzzle</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Arial, sans-serif;
  overflow:hidden;
  color:white;
  background:#070a12;
  position:relative;
}

/* ===== Bewegende logo achtergrond ===== */
body::before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;

  background-image:url("logo.png");
  background-repeat:repeat;
  background-size:70px 70px;
  opacity:0.10;

  animation:drift1 22s linear infinite;
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;

  background-image:url("logo.png");
  background-repeat:repeat;
  background-size:110px 110px;
  background-position:40px 30px;
  opacity:0.05;

  animation:drift2 38s linear infinite;
}

@keyframes drift1{
  from { transform: translate3d(0,0,0); }
  to   { transform: translate3d(-260px,-160px,0); }
}

@keyframes drift2{
  from { transform: translate3d(0,0,0); }
  to   { transform: translate3d(220px,-240px,0); }
}

/* ===== Layout ===== */
.wrapper{
  width:min(95vw,520px);
  z-index:2;
}

.topbar{
  text-align:center;
  margin-bottom:10px;
  font-weight:700;
  font-size:18px;
}

#game{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  background:#141a28;
  border-radius:20px;
  overflow:hidden;
  touch-action:none;
  z-index:2;
}

.piece{
  position:absolute;
  width:50%;
  height:50%;
  cursor:grab;
  touch-action:none;
  user-select:none;
}

.piece.dragging{ cursor:grabbing; }
.piece.locked{
  cursor:default;
  pointer-events:none;
}

#confetti{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:3;
}
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="wrapper">
  <div class="topbar">
    Tijd: <span id="time">00:00</span>
  </div>
  <div id="game"></div>
</div>

<script>
const RED="#B0002A";
const TAB=30;
const SIZE=200;
const R=18;

const defs=[
{ id:0,x:0,y:0,edges:[0,1,-1,0] },
{ id:1,x:200,y:0,edges:[0,0,1,-1] },
{ id:2,x:0,y:200,edges:[1,-1,0,0] },
{ id:3,x:200,y:200,edges:[-1,0,0,1] }
];

const game=document.getElementById("game");
const timeEl=document.getElementById("time");

let drag=null;
let placed=0;
let startTime=null;
let timerInterval=null;

function startTimer(){
  if(startTime) return;
  startTime=Date.now();
  timerInterval=setInterval(()=>{
    const t=Date.now()-startTime;
    timeEl.textContent=new Date(t).toISOString().substr(14,5);
  },100);
}

function stopTimer(){
  clearInterval(timerInterval);
}

function buildPath(top,right,bottom,left){
  function tab(out){
    const t=out?TAB:-TAB;
    return `c0 -20 ${t} -20 ${t} 0 c0 20 ${-t} 20 ${-t} 0`;
  }

  let d=`M${R} 0 H${SIZE-R} Q${SIZE} 0 ${SIZE} ${R}`;
  if(right) d+=tab(right>0);
  d+=`V${SIZE-R} Q${SIZE} ${SIZE} ${SIZE-R} ${SIZE}`;
  if(bottom) d+=tab(bottom>0);
  d+=`H${R} Q0 ${SIZE} 0 ${SIZE-R}`;
  if(left) d+=tab(left>0);
  d+=`V${R} Q0 0 ${R} 0 Z`;
  return d;
}

function createPiece(def){
  const el=document.createElement("div");
  el.className="piece";

  const path=buildPath(...def.edges);

  el.innerHTML=`
  <svg viewBox="0 0 200 200">
    <defs>
      <clipPath id="clip${def.id}">
        <path d="${path}"/>
      </clipPath>
    </defs>
    <g clip-path="url(#clip${def.id})">
      <text x="${200-def.x}" y="${260-def.y}"
        font-size="260"
        font-weight="900"
        fill="${RED}"
        text-anchor="middle"
        dominant-baseline="middle">34</text>
    </g>
    <path d="${path}" fill="none" stroke="white" stroke-width="3"/>
  </svg>`;

  el.style.left=Math.random()*200+"px";
  el.style.top=Math.random()*200+"px";

  el.addEventListener("pointerdown",e=>{
    if(el.classList.contains("locked"))return;
    startTimer();
    drag={
      el,
      def,
      offsetX:e.clientX-el.offsetLeft,
      offsetY:e.clientY-el.offsetTop
    };
    el.classList.add("dragging");
  });

  game.appendChild(el);
}

window.addEventListener("pointermove",e=>{
  if(!drag)return;
  drag.el.style.left=(e.clientX-drag.offsetX)+"px";
  drag.el.style.top=(e.clientY-drag.offsetY)+"px";
});

window.addEventListener("pointerup",()=>{
  if(!drag)return;

  const el=drag.el;
  const def=drag.def;
  el.classList.remove("dragging");

  const correctX=(def.x/400)*game.clientWidth;
  const correctY=(def.y/400)*game.clientHeight;

  if(Math.abs(el.offsetLeft-correctX)<30 &&
     Math.abs(el.offsetTop-correctY)<30){
    el.style.left=correctX+"px";
    el.style.top=correctY+"px";
    el.classList.add("locked");
    placed++;
    if(placed===4){
      stopTimer();
      launchConfetti();
    }
  }

  drag=null;
});

/* ===== Confetti ===== */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth*devicePixelRatio;
  canvas.height=window.innerHeight*devicePixelRatio;
  canvas.style.width=window.innerWidth+"px";
  canvas.style.height=window.innerHeight+"px";
}
resize();
window.addEventListener("resize",resize);

let confetti=[];

function launchConfetti(){
  for(let i=0;i<250;i++){
    confetti.push({
      x:Math.random()*canvas.width,
      y:-20,
      vx:(Math.random()-0.5)*4,
      vy:Math.random()*4+2,
      size:Math.random()*6+4,
      life:0
    });
  }
  animateConfetti();
}

function animateConfetti(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  confetti.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.life++;
    ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;
    ctx.fillRect(p.x,p.y,p.size,p.size);
  });
  requestAnimationFrame(animateConfetti);
}

defs.forEach(createPiece);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>34 Puzzle</title>

<style>
body{
    margin:0;
    background:#0e111a;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial, sans-serif;
    overflow:hidden;
    color:white;
}

.wrapper{
    width:min(95vw,520px);
}

.topbar{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
    font-weight:bold;
}

#game{
    position:relative;
    width:100%;
    aspect-ratio:1/1;
    background:#141a28;
    border-radius:20px;
    overflow:hidden;
}

.piece{
    position:absolute;
    width:50%;
    height:50%;
    cursor:grab;
    touch-action:none;
    transition:transform .15s ease;
}

.piece:active{
    transform:scale(1.05);
    cursor:grabbing;
}

.locked{
    cursor:default;
}

#confetti{
    position:fixed;
    inset:0;
    pointer-events:none;
}

.winOverlay{
    position:absolute;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    background:rgba(0,0,0,0.8);
    opacity:0;
    pointer-events:none;
    transition:.3s;
}

.winOverlay.show{
    opacity:1;
    pointer-events:auto;
}

.winBox{
    background:#1c2235;
    padding:20px;
    border-radius:15px;
    text-align:center;
}
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="wrapper">
<div class="topbar">
<div>Tijd: <span id="time">00:00</span></div>
<div>Score: <span id="score">10000</span></div>
</div>

<div id="game">
<div class="winOverlay" id="win">
<div class="winBox">
<h2>ðŸ”¥ 34 Complete!</h2>
<p id="finalStats"></p>
<button onclick="resetGame()">Nog een keer</button>
</div>
</div>
</div>
</div>

<script>
const RED = "#B0002A";
const TAB = 28;
const SIZE = 200;
const RADIUS = 18;

let pieces = [];
let placed = 0;
let moves = 0;
let startTime;
let timerInterval;

function buildPiecePath(top,right,bottom,left){
    const mid = SIZE/2;

    function tab(dir,out){
        const t = out ? TAB : -TAB;
        return `c0 ${-20} ${t} ${-20} ${t} 0 c0 20 ${-t} 20 ${-t} 0`;
    }

    let d = `M${RADIUS} 0 H${SIZE-RADIUS} Q${SIZE} 0 ${SIZE} ${RADIUS}`;

    if(right) d += tab("right",right>0);
    d += `V${SIZE-RADIUS} Q${SIZE} ${SIZE} ${SIZE-RADIUS} ${SIZE}`;

    if(bottom) d += tab("bottom",bottom>0);
    d += `H${RADIUS} Q0 ${SIZE} 0 ${SIZE-RADIUS}`;

    if(left) d += tab("left",left>0);
    d += `V${RADIUS} Q0 0 ${RADIUS} 0 Z`;

    return d;
}

const defs=[
{ id:0, x:0,y:0, edges:[0,1,-1,0] },
{ id:1, x:200,y:0, edges:[0,0,1,-1] },
{ id:2, x:0,y:200, edges:[1,-1,0,0] },
{ id:3, x:200,y:200, edges:[-1,0,0,1] }
];

const game=document.getElementById("game");

function createPiece(def){
    const div=document.createElement("div");
    div.className="piece";
    div.dataset.id=def.id;

    const path=buildPiecePath(...def.edges);

    div.innerHTML=`
<svg viewBox="0 0 200 200">
<defs>
<clipPath id="clip${def.id}">
<path d="${path}"/>
</clipPath>
</defs>

<g clip-path="url(#clip${def.id})">
<rect width="400" height="400" fill="none"/>
<text x="${200-def.x}" y="${260-def.y}"
font-size="260"
font-weight="900"
fill="${RED}"
text-anchor="middle"
dominant-baseline="middle">34</text>
</g>

<path d="${path}" fill="none" stroke="white" stroke-width="3"/>
</svg>`;

    div.style.left=Math.random()*200+"px";
    div.style.top=Math.random()*200+"px";

    enableDrag(div,def);
    game.appendChild(div);
    pieces.push(div);
}

function enableDrag(el,def){
let offsetX,offsetY;
el.onpointerdown=e=>{
    if(el.classList.contains("locked"))return;
    el.setPointerCapture(e.pointerId);
    offsetX=e.clientX-el.offsetLeft;
    offsetY=e.clientY-el.offsetTop;
    startGame();
    el.onpointermove=e=>{
        el.style.left=(e.clientX-offsetX)+"px";
        el.style.top=(e.clientY-offsetY)+"px";
    }
};
el.onpointerup=()=>{
    moves++;
    const correctX=(def.x/400)*game.clientWidth;
    const correctY=(def.y/400)*game.clientHeight;
    if(Math.abs(el.offsetLeft-correctX)<30 &&
       Math.abs(el.offsetTop-correctY)<30){
        el.style.left=correctX+"px";
        el.style.top=correctY+"px";
        el.classList.add("locked");
        placed++;
        if(placed===4) winGame();
    }
};
}

function startGame(){
if(!startTime){
startTime=Date.now();
timerInterval=setInterval(()=>{
const t=Date.now()-startTime;
document.getElementById("time").innerText=
new Date(t).toISOString().substr(14,5);
updateScore();
},100);
}
}

function updateScore(){
const elapsed=(Date.now()-startTime)/1000;
const score=Math.max(0,10000-elapsed*20-moves*50);
document.getElementById("score").innerText=Math.floor(score);
}

function winGame(){
clearInterval(timerInterval);
launchConfetti();
document.getElementById("finalStats").innerText=
"Tijd: "+document.getElementById("time").innerText+
" | Score: "+document.getElementById("score").innerText;
document.getElementById("win").classList.add("show");
}

function resetGame(){
pieces.forEach(p=>p.remove());
pieces=[];
placed=0;
moves=0;
startTime=null;
document.getElementById("time").innerText="00:00";
document.getElementById("score").innerText="10000";
document.getElementById("win").classList.remove("show");
init();
}

function init(){
defs.forEach(createPiece);
}
init();

/* CONFETTI */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

function launchConfetti(){
for(let i=0;i<200;i++){
confetti.push({
x:Math.random()*canvas.width,
y:-10,
vy:Math.random()*4+2,
size:Math.random()*6+4
});
}
animateConfetti();
}

let confetti=[];
function animateConfetti(){
ctx.clearRect(0,0,canvas.width,canvas.height);
confetti.forEach(p=>{
p.y+=p.vy;
ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;
ctx.fillRect(p.x,p.y,p.size,p.size);
});
requestAnimationFrame(animateConfetti);
}
</script>
</body>
</html>

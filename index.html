<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>34 Puzzle</title>

<style>
  :root{
    --red:#B0002A;
    --bg:#070a12;
    --panel:#141a28;
  }

  body{
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:Arial, sans-serif;
    overflow:hidden;
    color:white;
    background:var(--bg);
    position:relative;
  }

  /* ===== Bewegende logo achtergrond ===== */
  body::before{
    content:"";
    position:fixed;
    inset:-20%;
    pointer-events:none;
    z-index:0;
    background-image:url("logo.png");
    background-repeat:repeat;
    background-size:90px 90px;
    opacity:0.18;
    animation:drift1 26s linear infinite;
  }

  body::after{
    content:"";
    position:fixed;
    inset:-20%;
    pointer-events:none;
    z-index:0;
    background-image:url("logo.png");
    background-repeat:repeat;
    background-size:140px 140px;
    background-position:50px 30px;
    opacity:0.10;
    animation:drift2 42s linear infinite;
  }

  @keyframes drift1{
    from { transform: translate3d(0,0,0); }
    to   { transform: translate3d(-320px,-220px,0); }
  }
  @keyframes drift2{
    from { transform: translate3d(0,0,0); }
    to   { transform: translate3d(280px,-320px,0); }
  }

  .wrapper{
    width:min(96vw, 1200px);
    z-index:2;
  }

  .topbar{
    text-align:center;
    margin-bottom:10px;
    font-weight:800;
    font-size:20px;
    text-shadow: 0 2px 16px rgba(0,0,0,0.6);
  }

  #gameSizer{
    width:100%;
    display:flex;
    justify-content:center;
  }

  #game{
    position:relative;

    width:min(96vw, 94vh, 1200px);
    height:min(96vw, 94vh, 1200px);

    /* achtergrondkleur + mini-34 pattern */
    background-color: var(--panel);
    background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'>\
  <rect width='120' height='120' fill='none'/>\
  <text x='10' y='44' font-family='Arial' font-size='34' font-weight='900' fill='%23B0002A' opacity='0.34'>34</text>\
  <text x='58' y='98' font-family='Arial' font-size='34' font-weight='900' fill='%23B0002A' opacity='0.34'>34</text>\
</svg>");
    background-repeat: repeat;
    background-size: 120px 120px;

    border-radius:24px;
    overflow:hidden;
    touch-action:none;
    z-index:2;
    box-shadow: 0 16px 60px rgba(0,0,0,0.55);
  }

  .piece{
    position:absolute;
    width:50%;
    height:50%;
    cursor:grab;
    touch-action:none;
    user-select:none;
  }
  .piece.dragging{ cursor:grabbing; }
  .piece.locked{
    cursor:default;
    pointer-events:none;
  }

  #confetti{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:3;
  }
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="wrapper">
  <div class="topbar">
    Tijd: <span id="time">00:00</span>
  </div>

  <div id="gameSizer">
    <div id="game"></div>
  </div>
</div>

<script>
(() => {
  const RED = "#B0002A";
  const TAB = 30;
  const SIZE = 200;
  const R = 18;

  const defs = [
    { id:0, x:0,   y:0,   edges:[0,  1, -1,  0] },
    { id:1, x:200, y:0,   edges:[0,  0,  1, -1] },
    { id:2, x:0,   y:200, edges:[1, -1,  0,  0] },
    { id:3, x:200, y:200, edges:[-1, 0,  0,  1] }
  ];

  const game = document.getElementById("game");
  const timeEl = document.getElementById("time");

  let drag = null;
  let placed = 0;

  // timer
  let startTime = null;
  let timerInterval = null;

  function startTimer(){
    if(startTime) return;
    startTime = Date.now();
    timerInterval = setInterval(() => {
      const t = Date.now() - startTime;
      timeEl.textContent = new Date(t).toISOString().substr(14,5);
    }, 100);
  }

  function stopTimer(){
    if(timerInterval) clearInterval(timerInterval);
    timerInterval = null;
  }

  function buildPath(){
  return `
    M0 0
    H200
    V200
    H0
    Z
  `;
}

  function gameRect(){ return game.getBoundingClientRect(); }

  function randomizePos(el){
    const r = gameRect();
    const w = r.width * 0.5;
    const h = r.height * 0.5;
    const pad = 12;

    const x = Math.random() * (r.width - w - pad*2) + pad;
    const y = Math.random() * (r.height - h - pad*2) + pad;

    el.style.left = `${x}px`;
    el.style.top  = `${y}px`;
  }

  function createPiece(def){
    const el = document.createElement("div");
    el.className = "piece";

    const path = buildPath(...def.edges);

    el.innerHTML = `
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <clipPath id="clip${def.id}">
            <path d="${path}"></path>
          </clipPath>
        </defs>

        <g clip-path="url(#clip${def.id})">
          <text x="${200-def.x}" y="${260-def.y}"
                font-size="260" font-weight="900"
                fill="${RED}"
                text-anchor="middle"
                dominant-baseline="middle">34</text>
        </g>

        <path d="${path}" fill="none" stroke="white" stroke-width="2"
              stroke-linejoin="round"></path>
      </svg>
    `;

    randomizePos(el);

    el.addEventListener("pointerdown", (e) => {
      if(el.classList.contains("locked")) return;

      startTimer();
      el.classList.add("dragging");
      el.style.zIndex = String(1000 + (Date.now()%1000));

      drag = {
        el,
        def,
        offsetX: e.clientX - el.offsetLeft,
        offsetY: e.clientY - el.offsetTop,
        pointerId: e.pointerId
      };

      el.setPointerCapture(e.pointerId);
    });

    game.appendChild(el);
  }

  window.addEventListener("pointermove", (e) => {
    if(!drag) return;
    if(e.pointerId !== drag.pointerId) return;

    const r = gameRect();
    const w = r.width * 0.5;
    const h = r.height * 0.5;

    let x = e.clientX - drag.offsetX;
    let y = e.clientY - drag.offsetY;

    x = Math.max(-w*0.15, Math.min(r.width - w*0.85, x));
    y = Math.max(-h*0.15, Math.min(r.height - h*0.85, y));

    drag.el.style.left = `${x}px`;
    drag.el.style.top  = `${y}px`;
  });

  function endDrag(){
    if(!drag) return;

    const el = drag.el;
    const def = drag.def;

    el.classList.remove("dragging");

    const correctX = (def.x/400) * game.clientWidth;
    const correctY = (def.y/400) * game.clientHeight;

    const snapDist = Math.max(18, game.clientWidth * 0.06);

    if(Math.abs(el.offsetLeft - correctX) < snapDist &&
       Math.abs(el.offsetTop  - correctY) < snapDist){
      el.style.left = `${correctX}px`;
      el.style.top  = `${correctY}px`;
      el.classList.add("locked");
      placed++;

      if(placed === 4){
        stopTimer();
        launchConfetti();
      }
    }

    drag = null;
  }

  window.addEventListener("pointerup", endDrag);
  window.addEventListener("pointercancel", endDrag);
  window.addEventListener("lostpointercapture", endDrag);

  // ===== Confetti + Ballonnen =====
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");

  function resize(){
    canvas.width = window.innerWidth * devicePixelRatio;
    canvas.height = window.innerHeight * devicePixelRatio;
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
  }
  window.addEventListener("resize", resize);
  resize();

  let confetti = [];
  let balloons = [];
  let running = false;

  function rand(min, max){ return Math.random() * (max - min) + min; }

  function launchConfetti(){
    confetti = [];
    balloons = [];
    running = true;

    const W = canvas.width;
    const H = canvas.height;

    const N = Math.floor(1200 * (devicePixelRatio >= 2 ? 1.0 : 0.85));
    for(let i=0;i<N;i++){
      confetti.push({
        x: Math.random()*W,
        y: -Math.random()*H*0.6,
        vx: (Math.random()-0.5) * 5.0 * devicePixelRatio,
        vy: (Math.random()*3.0 + 3.0) * devicePixelRatio,
        g: 0.035 * devicePixelRatio,
        w: rand(6, 14) * devicePixelRatio,
        h: rand(4, 10) * devicePixelRatio,
        a: Math.random()*Math.PI*2,
        va: (Math.random()-0.5) * 0.35,
        life: 0,
        ttl: rand(320, 620),
        hue: Math.random()*360
      });
    }

    const B = 40;
    for(let i=0;i<B;i++){
      const startX = rand(0.08, 0.92) * W;
      const startY = H + rand(40, 300) * devicePixelRatio;
      balloons.push({
        x: startX,
        y: startY,
        vx: rand(-0.25, 0.25) * devicePixelRatio,
        vy: rand(1.6, 2.4) * devicePixelRatio,
        r: rand(22, 42) * devicePixelRatio,
        bob: rand(0.8, 1.6),
        phase: Math.random()*Math.PI*2,
        hue: Math.random()*360,
        alpha: rand(0.75, 0.95)
      });
    }

    requestAnimationFrame(tickCelebration);
  }

  function drawBalloon(b){
    ctx.save();
    ctx.translate(b.x, b.y);
    ctx.globalAlpha = b.alpha;

    ctx.fillStyle = `hsl(${b.hue} 90% 60%)`;
    ctx.beginPath();
    ctx.ellipse(0, 0, b.r*0.78, b.r, 0, 0, Math.PI*2);
    ctx.fill();

    ctx.globalAlpha = b.alpha * 0.35;
    ctx.fillStyle = "#ffffff";
    ctx.beginPath();
    ctx.ellipse(-b.r*0.22, -b.r*0.25, b.r*0.18, b.r*0.35, 0, 0, Math.PI*2);
    ctx.fill();

    ctx.globalAlpha = b.alpha;
    ctx.fillStyle = `hsl(${b.hue} 90% 45%)`;
    ctx.beginPath();
    ctx.moveTo(-b.r*0.18, b.r*0.95);
    ctx.lineTo(0, b.r*1.12);
    ctx.lineTo(b.r*0.18, b.r*0.95);
    ctx.closePath();
    ctx.fill();

    ctx.strokeStyle = "rgba(255,255,255,0.55)";
    ctx.lineWidth = 2 * devicePixelRatio;
    ctx.beginPath();
    ctx.moveTo(0, b.r*1.12);
    ctx.quadraticCurveTo(b.r*0.2, b.r*1.8, -b.r*0.15, b.r*2.6);
    ctx.stroke();

    ctx.restore();
  }

  function tickCelebration(){
    if(!running) return;

    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0,0,W,H);

    let aliveC = 0;
    for(const p of confetti){
      p.life++;
      if(p.life > p.ttl) continue;
      aliveC++;

      p.x += p.vx;
      p.y += p.vy;
      p.vy += p.g;
      p.a += p.va;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.a);
      ctx.globalAlpha = Math.max(0, 1 - p.life/p.ttl);
      ctx.fillStyle = `hsl(${p.hue} 95% 60%)`;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }

    for(const b of balloons){
      b.phase += 0.02;
      b.x += b.vx + Math.sin(b.phase) * b.bob * devicePixelRatio * 0.15;
      b.y -= b.vy;
      drawBalloon(b);
    }
    balloons = balloons.filter(b => b.y > -200 * devicePixelRatio);

    if(aliveC > 0 || balloons.length > 0){
      requestAnimationFrame(tickCelebration);
    } else {
      running = false;
      ctx.clearRect(0,0,W,H);
    }
  }

  // init
  defs.forEach(createPiece);
})();
</script>

</body>
</html>
